{
  "code_snippet": "\"\"\"Tests for CLAUDE.md and spec-kit playbook generation\"\"\"\n\nimport pytest\nimport subprocess\nimport sqlite3\nfrom pathlib import Path\n\n\n@pytest.mark.unit\ndef test_claude_md_generation(plugin_root, temp_project, temp_db):\n    \"\"\"Test CLAUDE.md generation with instructions-only format.\"\"\"\n    # Run playbook generator\n    result = subprocess.run(\n        ['python3', str(plugin_root / 'scripts' / 'generate-playbook.py')],\n        capture_output=True,\n        text=True,\n        cwd=str(temp_project)\n    )\n\n    assert result.returncode == 0\n\n    # Verify CLAUDE.md created\n    claude_md = temp_project / 'CLAUDE.md'\n    assert claude_md.exists()\n\n    content = claude_md.read_text()\n\n    # Should contain ACE plugin markers\n    assert '<!-- ACE-PLUGIN-START -->' in content\n    assert '<!-- ACE-PLUGIN-END -->' in content\n\n    # Should contain instructions (not pattern dumps)\n    assert 'ACE Plugin Instructions' in content\n    assert 'Pattern Database' in content\n    assert '.ace-memory/patterns.db' in content\n\n    # Should NOT be bloated with pattern dumps\n    lines = content.split('\\n')\n    assert len(lines) < 100  # Instructions-only should be ~50 lines\n\n\n@pytest.mark.unit\ndef test_claude_md_delta_update_preserves_user_content(plugin_root, temp_project, temp_db):\n    \"\"\"Test that CLAUDE.md updates preserve user content outside ACE section.\"\"\"\n    # Create CLAUDE.md with user content\n    claude_md = temp_project / 'CLAUDE.md'\n    claude_md.write_text(\"\"\"# My Custom Instructions\n\nThis is user content that should be preserved.\n\n<!-- ACE-PLUGIN-START -->\nOld ACE content\n<!-- ACE-PLUGIN-END -->\n\nMore user content below.\n\"\"\")\n\n    # Run playbook generator\n    result = subprocess.run(\n        ['python3', str(plugin_root / 'scripts' / 'generate-playbook.py')],\n        capture_output=True,\n        text=True,\n        cwd=str(temp_project)\n    )\n\n    assert result.returncode == 0\n\n    content = claude_md.read_text()\n\n    # User content should be preserved\n    assert '# My Custom Instruct",
  "full_code_length": 7681,
  "file_path": "plugins/ace-orchestration/tests/test_playbooks.py",
  "language": "python",
  "training_mode": "offline",
  "request_id": "test_playbooks-38fa8dd0"
}