{
  "code_snippet": "#!/usr/bin/env python3\n\"\"\"\nACE Cycle - Main orchestration script (TRUE ACE Research Paper Architecture)\n\nOrchestrates the complete ACE cycle per the research paper:\n1. Evidence Gathering (test results, execution feedback)\n2. Pattern Discovery via Reflector Agent (LLM-based code analysis - NO pre-detection!)\n3. Curation (deterministic algorithm: merge at 85% similarity, prune at 30% confidence)\n4. Domain Discovery (periodic, agent-based taxonomy learning)\n5. Playbook Update (CLAUDE.md generation with delta updates)\n\nCRITICAL ARCHITECTURE CHANGE (v2.3.9):\n- Removed hardcoded pattern detection (semantic_pattern_extractor.py)\n- Reflector agent NOW DISCOVERS patterns by analyzing raw code\n- This matches the TRUE ACE research paper architecture (Section 3, Figure 4)\n- Generator \u2192 Trajectory \u2192 Reflector (discovers patterns) \u2192 Curator (merges/prunes)\n\nACE Phase 3+ Enhancements:\n- Agent-based pattern discovery (not hardcoded keyword matching!)\n- Semantic embeddings for pattern similarity (Claude \u2192 ChromaDB \u2192 Jaccard fallback)\n- Delta-based CLAUDE.md updates (prevents context collapse)\n- Multi-epoch offline training mode\n- Bottom-up domain taxonomy discovery\n\nCalled by PostToolUse hook after Edit/Write operations.\n\"\"\"\n\nimport json\nimport sys\nimport os\nimport re\nimport sqlite3\nimport subprocess\nfrom pathlib import Path\nfrom datetime import datetime\nfrom typing import Dict, List, Any, Optional\n\n# ============================================================================\n# Configuration\n# ============================================================================\n\nSIMILARITY_THRESHOLD = 0.85  # 85% similarity for merging (from research)\nPRUNE_THRESHOLD = 0.30      # 30% confidence threshold (from research)\nMIN_OBSERVATIONS = 10        # Minimum observations before pruning\n\n# Plugin root directory\nPLUGIN_ROOT = Path(os.environ.get('CLAUDE_PLUGIN_ROOT', Path(__file__).parent.parent))\nPROJECT_ROOT = Path.cwd()\nDB_PATH = PROJECT_ROOT / '.ace-memory' / 'patterns.db'\n\n# ===========",
  "full_code_length": 38397,
  "file_path": "plugins/ace-orchestration/scripts/ace-cycle.py",
  "language": "python",
  "training_mode": "offline",
  "request_id": "ace-cycle-6d8984c6"
}