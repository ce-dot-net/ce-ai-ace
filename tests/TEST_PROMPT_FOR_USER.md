# 🧪 ACE Plugin Test - Ready to Copy & Paste

**For directory**: `/Users/ptsafaridis/repos/test_ace`

Copy everything below and paste into your Claude Code CLI session in the test_ace directory.

---

## 📋 COPY THIS ENTIRE BLOCK:

```
I'm testing the ACE plugin in /Users/ptsafaridis/repos/test_ace

Please help me test all Phase 3-5 features:

1. First verify the plugin is installed:
   Run: /plugin

2. Create a test Python file with patterns ACE should detect:

Create a file called `app.py` with this content:

```python
from typing import TypedDict
from dataclasses import dataclass
from pathlib import Path

# Pattern 1: TypedDict (py-001)
class ServerConfig(TypedDict):
    host: str
    port: int
    timeout: float

# Pattern 2: Dataclass (py-002)
@dataclass
class User:
    id: int
    name: str
    email: str
    active: bool = True

# Pattern 3: Context manager (py-004)
def load_config(config_path: Path) -> ServerConfig:
    with open(config_path, 'r') as f:
        data = f.read()
    return {"host": "localhost", "port": 8080, "timeout": 30.0}

# Pattern 4: F-strings (py-005)
def format_user(user: User) -> str:
    return f"User: {user.name} (ID: {user.id})"

# Pattern 5: List comprehension (py-006)
def get_active_users(users: list[User]) -> list[str]:
    return [u.name for u in users if u.active]

# Pattern 6: Pathlib (py-007)
config_file = Path.cwd() / "config" / "settings.json"

# Anti-pattern 7: Bare except (py-003) - should be flagged as harmful!
def risky_operation():
    try:
        result = 1 / 0
    except:  # BAD: bare except catches everything
        pass
```

3. After creating the file, wait 2-3 seconds for ACE cycle to run.

4. Now verify ACE detected the patterns:

Check patterns in database:
sqlite3 .ace-memory/patterns.db "SELECT bullet_id, name, confidence, observations FROM patterns"

Check CLAUDE.md was created/updated:
cat CLAUDE.md

Check embeddings cache was created:
ls -lh .ace-memory/

Check epoch status:
python3 ~/.claude-code-plugins/*/scripts/epoch-manager.py stats 2>/dev/null || echo "Epochs table not initialized yet"

5. Show me all the output so I can verify Phase 3-5 features are working!
```

---

## ✅ **What You Should See**

### After step 2 (file creation):
```
🔄 ACE: Starting reflection cycle for app.py
🔍 Detected 7 pattern(s): py-001, py-002, py-003, py-004, py-005, py-006, py-007
🧪 Evidence: none
💡 Reflection complete
🔄 Computing playbook delta...
📊 Delta: +7 ~0 -0
  ✨ Added [py-00001] to section 'STRATEGIES AND HARD RULES'
  ✨ Added [py-00002] to section 'STRATEGIES AND HARD RULES'
  ✨ Added [py-00003] to section 'TROUBLESHOOTING AND PITFALLS'
  ...
✅ Delta applied successfully
✅ ACE cycle complete (7 patterns processed)
```

### Step 4a - Database check:
```
[py-00001]|Use TypedDict for configs|0.0|1
[py-00002]|Use dataclasses for data structures|0.0|1
[py-00003]|Avoid bare except|0.0|1
[py-00004]|Use context managers for file operations|0.0|1
[py-00005]|Use f-strings for formatting|0.0|1
[py-00006]|Use list comprehensions|0.0|1
[py-00007]|Use pathlib over os.path|0.0|1
```

### Step 4b - CLAUDE.md:
```markdown
# ACE Playbook

*Auto-generated by ACE (Agentic Context Engineering)*
*Last updated: 2025-10-14T...*
*Total patterns: 7*

## 📊 Statistics

- **Total Observations**: 7
- **Success Rate**: 0.0%
- **High Confidence Patterns**: 0 (≥70%)
- **Medium Confidence Patterns**: 0 (30-70%)
- **Low Confidence Patterns**: 7 (<30%)
- **Anti-Patterns Identified**: 0

## 🔍 LOW-CONFIDENCE PATTERNS (<30%)

- [py-00001] **Use TypedDict for configs** (0%, 1 obs)
- [py-00002] **Use dataclasses for data structures** (0%, 1 obs)
- [py-00003] **Avoid bare except** (0%, 1 obs)
...
```

### Step 4c - Embeddings cache:
```
-rw-r--r-- 1 user staff 29K Oct 14 14:30 embeddings-cache.json
```

---

## 🎯 **Key Phase 3-5 Features to Verify**

✅ **Delta Updates** (Phase 3):
- Console shows: `🔄 Computing playbook delta...`
- Shows: `📊 Delta: +7 ~0 -0` (7 additions, 0 updates, 0 deletions)
- **NOT** showing full CLAUDE.md rewrite

✅ **Semantic Embeddings** (Phase 3):
- `embeddings-cache.json` file created in `.ace-memory/`
- File size ~29KB (contains cached embeddings)

✅ **Multi-Epoch** (Phase 4):
- `epoch-manager.py stats` shows epoch tracking
- Database has `epochs` table

✅ **Serena Integration** (Phase 5):
- Patterns detected with hybrid detector
- Falls back to regex (Serena symbolic when needed)

✅ **All 5 Hooks** (Phase 3-5):
- PostToolUse runs ACE cycle (you see the output)
- SessionEnd will run on exit

---

## 🐛 **Troubleshooting**

### Issue: No ACE cycle output after creating file
**Solution**: Try triggering it manually:
```bash
echo "# Updated" >> app.py
```

### Issue: No .ace-memory/ directory
**Solution**: It's created automatically after first pattern detection. If missing, check:
```bash
ls -la ~/.claude-code-plugins/
```

### Issue: "No such table: patterns"
**Solution**: Database will be created on first run. If error persists:
```bash
# Run migration
python3 ~/.claude-code-plugins/*/scripts/migrate-database.py
```

### Issue: Delta updates not showing
**Solution**: Check if symlink exists:
```bash
ls -la ~/.claude-code-plugins/*/scripts/playbook_delta_updater.py
```

---

## ✅ **Success Criteria**

After running the test, you should have:
- ✅ 7 patterns detected
- ✅ `.ace-memory/patterns.db` created with 7 entries
- ✅ `CLAUDE.md` created with bulletized structure
- ✅ `embeddings-cache.json` created (~29KB)
- ✅ Console shows delta updates: `🔄 Computing playbook delta...`
- ✅ Console shows: `✅ Delta applied successfully`

**If all checks pass, Phase 3-5 is fully operational!** 🎉

---

## 📊 **What This Proves**

This test verifies:
1. ✅ Pattern detection works (7 patterns found)
2. ✅ Database storage works (patterns.db populated)
3. ✅ Delta updates work (incremental CLAUDE.md changes)
4. ✅ Embeddings work (cache created)
5. ✅ Bulletized structure works (bullet IDs generated)
6. ✅ Hooks work (PostToolUse triggered)
7. ✅ Anti-pattern detection works (bare except flagged)

**Your plugin is ready for production use!** 🚀
