# ACE Plugin - Manual Test Guide

After updating the plugin, run these tests to verify all features work correctly.

---

## 1️⃣ **Automated Test Suite**

```bash
# Run the automated test suite
python3 tests/test-phase-3-5.py
```

**Expected output**:
```
🧪 ACE Plugin - Phase 3-5 Test Suite
======================================================================
🧪 Testing: Database migration (Phase 2)
   ✅ PASS
🧪 Testing: Embeddings engine
   ✅ PASS
🧪 Testing: Delta updater
   ✅ PASS
...
📊 Test Results: 9 passed, 0 failed
✅ All tests passed! Plugin is ready to use.
```

---

## 2️⃣ **Test Delta Updates**

Create a simple Python file to trigger pattern detection:

```bash
# Create test file
cat > test_delta.py << 'EOF'
from typing import TypedDict

class Config(TypedDict):
    name: str
    value: int

def process(config: Config):
    print(f"Processing {config['name']}")
EOF

# Trigger ACE cycle by editing
echo "# Updated" >> test_delta.py
```

**Expected**:
- ✅ Patterns detected
- ✅ CLAUDE.md updated with delta (not full rewrite)
- ✅ Console shows: `🔄 Computing playbook delta...`

---

## 3️⃣ **Test Embeddings**

Check embeddings cache and similarity:

```bash
# Check embeddings cache exists
ls -lh .ace-memory/embeddings-cache.json

# Test embeddings directly
python3 -c "
from scripts.embeddings_engine import calculate_semantic_similarity
sim = calculate_semantic_similarity('Use TypedDict', 'TypedDict usage')
print(f'Similarity: {sim:.3f}')
"
```

**Expected**:
```
Similarity: 0.817
```

---

## 4️⃣ **Test Multi-Epoch**

```bash
# Check epochs
python3 scripts/epoch-manager.py stats

# Start new epoch
python3 scripts/epoch-manager.py start

# Check stats again
python3 scripts/epoch-manager.py stats
```

**Expected**:
```
📊 Epoch Statistics

Epoch    Status       Patterns   Avg Conf     Duration
======================================================================
1        running      4          0.50         Running...
```

---

## 5️⃣ **Test Serena Integration**

```bash
# Test hybrid detector
python3 scripts/serena-pattern-detector.py
```

**Expected**:
```
🧪 Testing Serena Pattern Detector
==================================================
✅ Detected 4 patterns
✅ Serena integration ready (using hybrid mode)
```

---

## 6️⃣ **Test All Hooks**

The hooks will run automatically during Claude Code usage:

```bash
# Check hooks are configured
cat hooks/hooks.json | grep -E "AgentStart|AgentEnd|PreToolUse"
```

**Expected output**:
```json
"AgentStart": [
"AgentEnd": [
"PreToolUse": [
```

---

## 7️⃣ **Test Pattern Detection**

```bash
# Check patterns in database
sqlite3 .ace-memory/patterns.db "SELECT bullet_id, name, confidence FROM patterns LIMIT 5"
```

**Expected**:
```
[py-00001]|Use context managers|0.0
[py-00002]|Use f-strings|0.0
[py-00003]|Use list comprehensions|0.0
```

---

## 8️⃣ **Check CLAUDE.md**

```bash
# View playbook
cat CLAUDE.md | head -30
```

**Expected structure**:
```markdown
# ACE Playbook

*Auto-generated by ACE (Agentic Context Engineering)*

## 🎯 STRATEGIES AND HARD RULES

[py-00001] helpful=0 harmful=0 :: **Pattern Name**
```

---

## 9️⃣ **Verify File Structure**

```bash
# Check all new files exist
ls -1 scripts/{playbook-delta-updater,embeddings_engine,epoch-manager,serena-pattern-detector}.py
ls -1 scripts/{inject-playbook,analyze-agent-output,validate-patterns}.py
ls -1 docs/{GAP_ANALYSIS,PHASES_3_5_COMPLETE}.md
```

**Expected**: All files listed (no errors)

---

## 🔟 **Integration Test**

Create a complete test scenario:

```bash
# Create test project
mkdir ace-test && cd ace-test

# Create Python file with patterns
cat > config.py << 'EOF'
from typing import TypedDict
from dataclasses import dataclass

class Config(TypedDict):
    api_key: str
    timeout: int

@dataclass
class Settings:
    debug: bool
    log_level: str

def load_config() -> Config:
    return Config(api_key="test", timeout=30)

# Anti-pattern (will be detected)
try:
    result = load_config()
except:  # Bare except
    pass
EOF

# Wait for ACE cycle to complete
sleep 5

# Check results
echo "Patterns detected:"
sqlite3 ../.ace-memory/patterns.db "SELECT COUNT(*) FROM patterns WHERE file_path LIKE '%config.py%'"

echo "\nCLAUDE.md updated:"
cat ../CLAUDE.md | grep -c "py-"
```

**Expected**:
- ✅ Multiple patterns detected (TypedDict, dataclass, bare except)
- ✅ CLAUDE.md updated with patterns
- ✅ Database populated

---

## ✅ **Success Criteria**

All tests should pass with:
- ✅ Database has bullet_id, helpful_count, harmful_count
- ✅ Embeddings engine working (local or OpenAI backend)
- ✅ Delta updater parsing CLAUDE.md correctly
- ✅ Epochs table exists in database
- ✅ Serena hybrid detector functional
- ✅ All 5 hooks configured in hooks.json
- ✅ All hook scripts exist and executable
- ✅ Documentation complete

---

## 🐛 **Troubleshooting**

### Issue: Embeddings fail
```bash
# Install sentence-transformers for local backend
pip install sentence-transformers
```

### Issue: Delta updates fail
```bash
# Check symlink exists
ls -la scripts/playbook_delta_updater.py

# Recreate if needed
cd scripts && ln -sf playbook-delta-updater.py playbook_delta_updater.py
```

### Issue: Hooks not running
```bash
# Restart Claude Code
# Hooks only activate after restart
```

### Issue: Database errors
```bash
# Run migration
python3 scripts/migrate-database.py
```

---

## 📊 **Expected Performance**

After running the plugin for a while:
- 📈 Patterns accumulate in database
- 📈 CLAUDE.md grows with insights
- 📈 Confidence scores improve over time
- 📈 Embeddings cache speeds up similarity checks
- 📈 Delta updates prevent context collapse

---

## 🚀 **Next Steps**

Once all tests pass:
1. Use Claude Code normally
2. Edit Python/JS/TS files
3. Watch ACE learn patterns automatically
4. Check CLAUDE.md periodically
5. Run `/ace-status` to see learning progress

**The plugin is now fully operational! 🎉**
