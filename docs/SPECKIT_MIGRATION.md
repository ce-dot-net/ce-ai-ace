# spec-kit Integration Guide

This guide explains ACE's integration with spec-kit structured playbooks. ACE now generates playbooks in **two formats**:
- **spec-kit** (`specs/`) - Human-readable, version-controlled
- **Claude Code CLI** (`CLAUDE.md`) - Optimized for Claude Code context injection

## ğŸ¯ Overview

ACE now generates playbooks in **spec-kit format** - a standardized, human-readable structure inspired by GitHub's spec-driven development toolkit.

### Dual Format Architecture

**spec-kit format** (`specs/` - committed to git):
- Hierarchical organization by pattern
- Each pattern gets its own directory
- Version control friendly
- Human-readable markdown with YAML frontmatter
- Team synchronization
- Cross-project sharing

**Claude Code CLI format** (`CLAUDE.md` - auto-generated):
- Single-file bulletized structure
- Optimized for Claude Code context injection
- Auto-generated from `specs/` and SQLite database
- Gitignored (regenerated on demand)

## ğŸ—ï¸ New Architecture

### Dual Storage System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SQLite Database (.ace-memory/)          â”‚
â”‚ â€¢ Learning engine                       â”‚
â”‚ â€¢ Pattern tracking & statistics         â”‚
â”‚ â€¢ Reflector insights                    â”‚
â”‚ â€¢ Gitignored (local state)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â–¼                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ spec-kit Playbooks       â”‚  â”‚ Claude Code CLI Format    â”‚
â”‚ (specs/)                 â”‚  â”‚ (CLAUDE.md)               â”‚
â”‚ â€¢ Human-readable         â”‚  â”‚ â€¢ For Claude Code CLI     â”‚
â”‚ â€¢ Git committed          â”‚  â”‚ â€¢ Single file format      â”‚
â”‚ â€¢ Hierarchical structure â”‚  â”‚ â€¢ Auto-generated          â”‚
â”‚ â€¢ AI agent compatible    â”‚  â”‚ â€¢ Gitignored              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Directory Structure

```
specs/
â”œâ”€â”€ memory/
â”‚   â””â”€â”€ constitution.md          # Principles (â‰¥70% confidence)
â”‚
â””â”€â”€ playbooks/
    â”œâ”€â”€ 003-avoid-bare-except/
    â”‚   â”œâ”€â”€ spec.md              # Pattern definition
    â”‚   â”œâ”€â”€ plan.md              # Technical approach
    â”‚   â””â”€â”€ insights.md          # Reflector analysis
    â”‚
    â”œâ”€â”€ 004-use-context-managers-for-file-operations/
    â”‚   â”œâ”€â”€ spec.md
    â”‚   â”œâ”€â”€ plan.md
    â”‚   â””â”€â”€ insights.md
    â”‚
    â””â”€â”€ 005-use-f-strings-for-formatting/
        â”œâ”€â”€ spec.md
        â”œâ”€â”€ plan.md
        â””â”€â”€ insights.md
```

## ğŸš€ Setup

### 1. Generate Playbooks

spec-kit playbooks are automatically generated by ACE:

```bash
# Generate both formats (default)
python3 scripts/generate-playbook.py

# Or explicitly
python3 scripts/generate-playbook.py --format both
```

**Output**:
- Creates `specs/memory/constitution.md`
- Creates `specs/playbooks/NNN-pattern-name/` directories
- Generates `spec.md`, `plan.md`, `insights.md` for each pattern
- Updates `CLAUDE.md` for Claude Code CLI

### 2. Review Generated Files

```bash
# View constitution
cat specs/memory/constitution.md

# Browse playbooks
ls specs/playbooks/

# Read a specific pattern
cat specs/playbooks/004-use-context-managers-for-file-operations/spec.md
```

### 3. Commit to Git

```bash
# Add specs/ directory
git add specs/

# Commit (ACE will learn from this history!)
git commit -m "feat: Add spec-kit playbooks from ACE learning"

# Push to remote
git push
```

### 4. Verify Integration

Test that ACE now uses spec-kit format:

```bash
# Generate both formats
python3 scripts/generate-playbook.py --format both

# Test context injection (should read from specs/)
# Edit any Python file and check that playbooks are injected

# Check stats
/ace-status
```

## ğŸ“ File Format Details

### spec.md - Pattern Definition

```yaml
---
pattern_id: py-004
name: Use context managers for file operations
domain: python-io
language: python
type: helpful
confidence: 0.0508
observations: 59
created_at: 2025-10-14T13:42:22.094486
last_updated: 2025-10-14T21:54:41.130114
---

# Use context managers for file operations

## Pattern Overview
...
```

**Sections**:
- YAML frontmatter with metadata
- Pattern overview with confidence stats
- Description and usage guidelines
- Related patterns

### plan.md - Technical Approach

```yaml
---
pattern_id: py-004
type: technical_plan
updated: 2025-10-14T22:21:20.699043
---

# Technical Plan: Use context managers for file operations

## Summary
...

## Implementation Approach
...

## Success Criteria
...
```

**Sections**:
- YAML frontmatter
- Latest Reflector insight
- Implementation approach
- Success criteria

### insights.md - Reflector Analysis

```yaml
---
pattern_id: py-004
type: reflector_insights
insight_count: 3
updated: 2025-10-14T22:21:20.699043
---

# Insights: Use context managers for file operations

## Reflector Analysis
...

### Insight #1 (2025-10-14T21:54:41.130114)
...
```

**Sections**:
- YAML frontmatter with insight count
- Historical insights from Reflector
- Chronological analysis

## ğŸ”„ Ongoing Usage

### Automatic Generation

ACE now automatically generates **both** formats:

```bash
# Default: Generate both legacy and spec-kit
python3 scripts/generate-playbook.py

# Only spec-kit
python3 scripts/generate-playbook.py --format speckit

# Only legacy
python3 scripts/generate-playbook.py --format legacy
```

### Context Injection

ACE's `inject-playbook.py` now:
1. **First** tries to read from `specs/` (preferred)
2. **Fallback** to `CLAUDE.md` if specs/ doesn't exist
3. **Dynamic filtering** by language and domain

### Git-Based Training

New feature: ACE can learn from committed playbooks!

```bash
# Train from specs/ git history
python3 scripts/offline-training.py --source specs-history

# ACE learns from ACE! (meta-learning)
```

## ğŸ Benefits

### Version Control
```bash
# See pattern evolution
git log specs/playbooks/004-use-context-managers-for-file-operations/spec.md

# Compare versions
git diff HEAD~5 specs/playbooks/004-use-context-managers-for-file-operations/spec.md

# Rollback if needed
git checkout HEAD~3 -- specs/playbooks/004-use-context-managers-for-file-operations/
```

### Team Synchronization
```bash
# Pull latest patterns from team
git pull

# Push your learned patterns
git push

# Everyone gets same patterns automatically
```

### Cross-Project Sharing
```bash
# Export specific playbook
tar -czf python-io-patterns.tar.gz -C specs/playbooks 004-use-context-managers-for-file-operations/

# Import to another project
cd /path/to/other/project
tar -xzf python-io-patterns.tar.gz -C specs/playbooks/
```

### Human Readability
```bash
# Easy to read
cat specs/playbooks/*/spec.md

# Easy to search
grep -r "confidence" specs/playbooks/*/spec.md

# Easy to understand
find specs/playbooks -name "spec.md" | xargs less
```

## ğŸ› Troubleshooting

### specs/ Not Generated?

```bash
# Check database exists
ls .ace-memory/patterns.db

# Check patterns exist
sqlite3 .ace-memory/patterns.db "SELECT COUNT(*) FROM patterns"

# Re-run migration
python3 scripts/migrate-to-speckit.py
```

### Context Injection Not Working?

```bash
# Check specs/ exists
ls specs/playbooks/

# Test injection directly
python3 scripts/inject-playbook.py < /dev/null

# Check hook is registered
cat hooks/hooks.json | grep inject-playbook
```

### Git Conflicts in specs/?

```bash
# Use automatic merge (ACE's curator handles duplicates)
git merge --strategy=recursive --strategy-option=theirs

# Or manually merge specific playbooks
git checkout --theirs specs/playbooks/004-*/spec.md
```

## ğŸ”§ Format Selection

You can choose which formats to generate:

```bash
# Both formats (recommended)
python3 scripts/generate-playbook.py --format both

# Only spec-kit (for git commits)
python3 scripts/generate-playbook.py --format speckit

# Only Claude Code CLI format
python3 scripts/generate-playbook.py --format legacy
```

## ğŸ“š Learn More

- **spec-kit Project**: https://github.com/github/spec-kit
- **spec-driven Development**: https://github.blog/ai-and-ml/generative-ai/spec-driven-development-with-ai-get-started-with-a-new-open-source-toolkit/
- **ACE Research Paper**: https://arxiv.org/abs/2510.04618
- **specs/README.md**: See `specs/README.md` for playbook documentation

## ğŸ¤ Contributing

Improvements to spec-kit integration welcome:

1. Better YAML frontmatter schemas
2. Automated testing for spec-kit format
3. Visual diff tools for pattern evolution
4. Integration with other AI coding agents
5. Enhanced constitution generation

## ğŸ’¡ Next Steps

1. âœ… Run migration
2. âœ… Review generated playbooks
3. âœ… Commit to git
4. âœ… Test context injection
5. ğŸ”„ Use git-based training
6. ğŸ”„ Share patterns with team
7. ğŸ”„ Explore pattern evolution via git log

---

**Migration complete! ACE now uses spec-kit format for better human-AI collaboration.**

*Based on research: [Agentic Context Engineering](https://arxiv.org/abs/2510.04618)*
*Inspired by: [GitHub spec-kit](https://github.com/github/spec-kit)*
